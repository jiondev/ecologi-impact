<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ecologi Impact Dashboard</title>

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
	
	<link rel="icon" type="image/png" href="favicon.png">

    <style>
        body {
            background: linear-gradient(135deg, #5cb270, #2d7a4b);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            overflow: hidden;
        }

        .impact-container {
			max-width: 700px;
			width: 100%;
			padding: 0 1rem;        /* ðŸ‘ˆ adds mobile spacing */
			transform: translateY(-40px);
		}

        .impact-card {
            border-radius: 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s forwards;
        }
		
		@media (max-width: 576px) {
			.impact-container {
				padding: 0 1.25rem;
			}
		}

        .impact-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .impact-title {
            font-size: 1.6rem;
            font-weight: bold;
        }

        .impact-value {
            font-size: 2.8rem;
            font-weight: 800;
        }

        /* Bottom bar */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px 20px;
            backdrop-filter: blur(6px);
        }

        .error-box {
            display: none;
        }
    </style>
</head>

<body>

<div class="impact-container text-center">

    <!-- Error Message -->
    <div id="errorBox" class="alert alert-danger error-box" role="alert">
        <!-- Filled via JS -->
    </div>

    <div class="row g-4">
        <!-- Trees -->
        <div class="col-md-6">
            <div class="card impact-card p-4 text-dark bg-white">
                <div class="impact-title">Trees Planted</div>
                <div id="treesValue" class="impact-value">0</div>
            </div>
        </div>

        <!-- Carbon Offset -->
        <div class="col-md-6">
            <div class="card impact-card p-4 text-dark bg-white">
                <div class="impact-title">Carbon Offset (tCOâ‚‚e)</div>
                <div id="carbonValue" class="impact-value">0</div>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Input Bar -->
<div class="bottom-bar">
    <div class="container">
        <div class="row gx-2">
            <div class="col-9">
                <input id="usernameInput" type="text" class="form-control form-control-lg"
                       placeholder="Enter Ecologi username" value="">
            </div>
            <div class="col-3">
                <button class="btn btn-light btn-lg w-100" onclick="loadImpact()">Load</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Smooth numeric animation
function animateValue(element, start, end, duration) {
    let startTime = null;
    function frame(time) {
        if (!startTime) startTime = time;
        let progress = Math.min((time - startTime) / duration, 1);
        let value = Math.floor(progress * (end - start) + start);
        element.textContent = value.toLocaleString();
        if (progress < 1) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
}

async function loadImpact() {
    const username = document.getElementById("usernameInput").value.trim();
    const treesEl = document.getElementById("treesValue");
    const carbonEl = document.getElementById("carbonValue");
    const errorBox = document.getElementById("errorBox");
    const url = `https://public.ecologi.com/users/${username}/impact`;

    // Reset error message
    errorBox.style.display = "none";

    try {
        const response = await fetch(url);
        const data = await response.json();

        // API error format:
        // { responseCode: "...", error: "User not found or private" }
        if (data.error) {
            throw new Error(data.error);
        }

        animateValue(treesEl, 0, data.trees, 1200);
        animateValue(carbonEl, 0, data.carbonOffset, 1200);
    }
    catch (err) {
        treesEl.textContent = "0";
        carbonEl.textContent = "0";

        errorBox.textContent = err.message;
        errorBox.style.display = "block";
    }
}
</script>

</body>
</html>
